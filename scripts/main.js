"use strict";var app=angular.module("TicTacToeApp",["ngMaterial"]);app.config(function($mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("grey").accentPalette("red").warnPalette("green")}),app.controller("AppCtrl",["$scope","$timeout","Board","MinimaxService",function($scope,$timeout,Board,MinimaxService){var vm=this;vm.board=new Board,vm.clickTile=function(idx){vm.board.tiles[idx]||vm.thinking||vm.gameOver||(vm.thinking=!0,vm.board.mark(1,idx),vm.gameOver=vm.board.winner()||vm.board.full(),vm.gameOver||vm.board.mark(2,MinimaxService.getMove(vm.board)),vm.gameOver=vm.board.winner()||vm.board.full(),vm.thinking=!1)},vm.symbols={1:"&#9675;",2:"&times;",0:""},vm.toggleSymbols=function(){_.any(this.board.tiles)||("&times;"===vm.symbols[2]?(vm.symbols[2]="&#9675;",vm.symbols[1]="&times;"):(vm.symbols[2]="&times;",vm.symbols[1]="&#9675;"))},vm.classForSymbol=function(symbol){return"&times;"===symbol?"md-accent":"md-warn"},vm.symbolForPlayer=function(player){return vm.symbols[player]},$scope.$watch("vm.gameOver",function(newVal,oldVal){newVal!==oldVal&&newVal&&$timeout(function(){vm.board=new Board,vm.gameOver=!1},2e3)})}]),app.service("MinimaxService",["COMPUTER","PLAYER",function(COMPUTER,PLAYER){function miniMove(board,depth){var winner=board.winner(),moves=board.moves(),best=1/0;return winner===COMPUTER?20-depth:winner===PLAYER?depth-20:moves.length?(moves.forEach(function(move){best=Math.min(maxiMove(board.copy().mark(PLAYER,move),depth+1),best)}),best):0}function maxiMove(board,depth){var winner=board.winner(),moves=board.moves(),best=-(1/0);return winner===COMPUTER?20-depth:winner===PLAYER?depth-20:moves.length?(moves.forEach(function(move){best=Math.max(miniMove(board.copy().mark(COMPUTER,move),depth+1),best)}),best):0}this.getMove=function(board){var best=-(1/0),moves=board.moves(),bestMove=moves[0];return moves.length<8?moves.forEach(function(move){var score=miniMove(board.copy().mark(COMPUTER,move),0);score>best&&(best=score,bestMove=move)}):_.contains(moves,4)&&(bestMove=4),bestMove}}]),app.constant("WINS",[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]),app.constant("PLAYER",1),app.constant("COMPUTER",2),app.factory("Board",["WINS",function(WINS){function Board(tiles){this.tiles=tiles?tiles:[0,0,0,0,0,0,0,0,0]}return Board.prototype.copy=function(){return new Board(this.tiles.slice())},Board.prototype.mark=function(player,index){return this.tiles[index]=player,this},Board.prototype.moves=function(){var m=[];return this.tiles.forEach(function(tile,move){tile||m.push(move)}),m},Board.prototype.winner=function(){for(var i=0;i<WINS.length;i++){var w=WINS[i];if(this.tiles[w[0]]&&this.tiles[w[0]]===this.tiles[w[1]]&&this.tiles[w[1]]===this.tiles[w[2]])return this.tiles[w[0]]}return""},Board.prototype.full=function(){return _.every(this.tiles,_.identity)},Board}]),app.filter("symbol",["$sce",function($sce){return function(symbol){return symbol?$sce.trustAsHtml(symbol):""}}]);